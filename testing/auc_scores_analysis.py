from functions.data_loader import load_trials
import matplotlib.pyplot as plt


auc_scores_lstm_ocsvm = {
    '11461549': [0.5354641289072116, 0.4660665040057586, 0.4748327428306114, 0.50633224581117, 0.3531689274040004, 0.3807468067669431, 0.4898040902051335, 0.47689467238784344, 0.6656595401245821, 0.4515588337025923], 
    '11461550': [0.25684344355012106, 0.5036707768149, 0.5155250800061075, 0.5085054204722153, 0.5496477238379249, 0.5056853415100042, 0.49730861635396506, 0.6754989670097502, 0.4059000414442544, 0.5315468678426863], 
    '11474168': [0.48803227042843383, 0.44048106496153167, 0.49969524450552016, 0.39706462499182016, 0.5103289676641333, 0.5140651827753939, 0.4579337702118643, 0.421235973612786, 0.4966832132073179, 0.3180992979405633], 
    '11474169': [0.4301935415517601, 0.3575451913758558, 0.4689891029656013, 0.4654934514961999, 0.4698768825195614, 0.48171778644056173, 0.5051755460202609, 0.45334654563697957, 0.4621978542471013, 0.4244405804688499], 
    '11478120': [0.49212185234004235, 0.4436358140679873, 0.39002284108153923, 0.49272263822282053, 0.44730846054849754, 0.5466456640896442, 0.47178113694365764, 0.5700202235496848, 0.47722217548058193, 0.5167509574245979], 
    '11478121': [0.5116713875723327, 0.6751711523060767, 0.3952205114781888, 0.3487580746183545, 0.5283472467615833, 0.36426601602303427, 0.42560943308622584, 0.42785240859672247, 0.3876159582192058, 0.4647427807536622]
} # best is 11478121 trial 1 with last reversed pooling, 11461550 trial 7 with last pooling, 11474168 trial 7 & 22_07_18_1520 with mean pooling


auc_scores_lstm_ocsvm_hypertraining = {
    '11120653': [0.46466643607457475, 0.7490943028172745, 0.756311212073054, 0.5800946050798814, 0.40214076712379987, 0.4916718861498288, 0.4815164857765189, 0.49476992206610515, 0.33656629678448674, 0.4370215603605962, 0.5755865296824996, 0.7613440402850618, 0.30060327877025855, 0.4915089136307972, 0.540464549581974, 0.6022710204946513, 0.4949640556786419, 0.6395029182364067, 0.509214023738521, 0.4563280390635468, 0.5345800886844722, 0.4880425535892906, 0.5118047570525345, 0.538574940871825, 0.5840177867521728, 0.41290131593297874, 0.503340469223746, 0.4972011105813725, 0.5888165951519571, 0.5944296429250295, 0.4532907672796054, 0.5566577234328307, 0.4920433263844095, 0.6718727505585627, 0.5595217395368839, 0.4416218725947531, 0.4882142512145036, 0.4939288841524026, 0.43668346249606593, 0.5081782289904118, 0.5595011732151705, 0.47388201786777095, 0.6195666738337182, 0.5257131995275978, 0.354114354980945, 0.4974438554997772, 0.64304001396017, 0.46625004284650357, 0.6454054525681416, 0.49328852368087306, 0.4900144275862929, 0.5012554804573202, 0.5127274370312203, 0.7034707225945973, 0.5243523945742304, 0.5194865898234101, 0.4752297351618663, 0.5581793196286844, 0.5007244954239934, 0.410877714520758], 
    '11120654': [0.5482551345691823, 0.38212163421238776, 0.4665273765786989, 0.5459479672060652, 0.6253202581384987, 0.7018852461570582, 0.6891786870584863, 0.4951628634552044, 0.4543521141243888, 0.40548778017718196, 0.5443166839610736, 0.4776702720051852, 0.49006522016870613, 0.5262326549563277, 0.4240560525749969, 0.5260715521029065, 0.5514002237366514, 0.4186988373796013, 0.44847606672213347, 0.673233867122865, 0.4349001131147694, 0.3672197760763821, 0.5598941146042697, 0.44879577954149563, 0.4368713638899016, 0.4908950400887468, 0.4778447741288137, 0.44465197732718836, 0.6086926986441809, 0.5167160569998722, 0.4710638085711704, 0.5029042139146747, 0.5039611982063674, 0.4447040163533419, 0.48822889692845106, 0.49975507380504997, 0.6883130318809147, 0.4605728032208106, 0.47074440736274314, 0.6432151393056685, 0.641150093639086, 0.5833730637275523, 0.6868877234639919, 0.511073717798905, 0.4099593970951628, 0.6777079769283263, 0.48367968888764246, 0.48807277984999053, 0.45666239759685645, 0.44373958050935924, 0.4644486200309741, 0.49960612377809566, 0.5740328375603356, 0.39199191058012606, 0.4065335464752129, 0.4638409787076248, 0.4973980486923247, 0.49605220106383974, 0.38320136610233924, 0.5387681396515567], 
    '11120655': [0.49520212643302075, 0.4216691128125068, 0.47511786683618296, 0.5028658857696634, 0.3767834272840302, 0.5362269524762162, 0.6784782791597722, 0.6651578465191501, 0.36079404698469675, 0.5840227725271335, 0.5128321383053975, 0.46911966794738763, 0.542649565458551, 0.319082430440649, 0.5162645327549834, 0.6898916528778828, 0.502966536101685, 0.3921570643757031, 0.5488786680502192, 0.5358442942479738, 0.7274847076933624, 0.3082193616338385, 0.6922499244343483, 0.2623193825117711, 0.34563884915849463, 0.403817545565309, 0.5335505261550639, 0.5115233723781835, 0.5249058155948809, 0.5263395375070502, 0.7444020653572775, 0.5736710572647415, 0.619240728795655, 0.5894310919158775, 0.5364615955103096, 0.6523285127121681, 0.40736274317338345, 0.5444441328335095, 0.5255966570378887, 0.4106997846768439, 0.39779192491422904, 0.6511668271462983, 0.5184009373256926, 0.6173436414230649, 0.5208988105810609, 0.5411282808736324, 0.37199708332164794, 0.5250725274451331, 0.5073318936908133, 0.47010747461149904, 0.34435158438579927, 0.5059620520203295, 0.34594017693268886, 0.5550105480301515, 0.47284341862124624, 0.3978134260687476, 0.5080286557415873, 0.308626325515015, 0.45733423077282626, 0.6436747654348687], 
    '11316965': [0.4619052515790884, 0.5200848828187079, 0.5386746563710414, 0.591776587424006, 0.4769239638157382, 0.40124395085272335, 0.2929466864851221, 0.3281811581332012, 0.39422242165322063, 0.5467656342996389, 0.4366314234699124, 0.3885763431210328, 0.24944486511920677, 0.525855294113981, 0.4687447999925214, 0.4723376740736587, 0.49440751854864085, 0.7115168285485474, 0.48477998709930725, 0.6422077011526488, 0.4366423298526392, 0.48849532427791953, 0.5267284279539937, 0.4672998600866901, 0.4278399441593204, 0.4936929946745691, 0.5781501528451638, 0.6093084418518414, 0.6060829570631293, 0.5170653728580643, 0.5548606631703921, 0.6581637390819319, 0.4341597255330884, 0.35046881865178414, 0.4238712672905117, 0.4502531838847289, 0.7528688460735464, 0.35845789980461995, 0.5474776652862302, 0.4324228061811145, 0.637644470619763, 0.5494006163664296, 0.7531863776163633, 0.5009233032005559, 0.6841605045604261, 0.587647430923646, 0.716200340902363, 0.5911820337599286, 0.5327443886660871, 0.4680159420154372, 0.7404689121350646, 0.4358081473795078, 0.49041235475035283, 0.44559273074010713, 0.49152698706503006, 0.6992982521742653, 0.5004110148233322, 0.5855057289670409, 0.3407319117642476, 0.6980405904403998], 
    '11316966': [0.7095405919984543, 0.5246855066637999, 0.4327524905503983, 0.5316942598149654, 0.29496717178799237, 0.6977878739720734, 0.4152265567303288, 0.4419630865686339, 0.4935801915160807, 0.44997616176346855, 0.4967131278570827, 0.5161909925743114, 0.5532705125688271, 0.3938665619653925, 0.4909623480507178, 0.4488680732784275, 0.4652245312592509, 0.491985055139555, 0.5259029705870439, 0.4954978452103841, 0.5654152371515021, 0.598323533169426, 0.6945427576944531, 0.3634209271671762, 0.4971936319189313, 0.474328556337699, 0.4420989489363161, 0.2855390713370914, 0.40615774368754143, 0.7153988775774119, 0.6479796705025973, 0.4905613047773072, 0.6708026786075978, 0.480489416134591, 0.4190902207140253, 0.5213621760414817, 0.3001570519112657, 0.46405380897626464, 0.5267979171925101, 0.39832415639129604, 0.4683072982397098, 0.32205052459700917, 0.4306410148544933, 0.7182407693050765, 0.4396830293568662, 0.43174972656140453, 0.45031519446080404, 0.5644754185713885, 0.4534007659396784, 0.38212101099051765, 0.3995092127772948, 0.5267779740926668, 0.5341372895457648, 0.4806919632423741, 0.514536026898256, 0.4662064173155965, 0.4790834275956412, 0.4510337692770315, 0.5085135223565266, 0.4683185162333717],
    '11316967': [0.49386593874352236, 0.44622717060387085, 0.5155733797010404, 0.4946817361714857, 0.46028799082617405, 0.4348190942716562, 0.49028365943417684, 0.4638864739041422, 0.7064880512786954, 0.4548986797044682, 0.6268368685593915, 0.33513974192382356, 0.6331220611193689, 0.5192295108019931, 0.38906307940158236, 0.5264595077170449, 0.5293453365865515, 0.5475184863187219, 0.6876923028982933, 0.5488817841595697, 0.47335539538753496, 0.49641086525008343, 0.5294388198670668, 0.5395365722173923, 0.5288938123416627, 0.44434691022177353, 0.5173570406932719, 0.5770479849678886, 0.5015708307235917, 0.5293618519661092, 0.5073191176424763, 0.6110188742743361, 0.48937811805691883, 0.43614967296432366, 0.46286002748408445, 0.5187648988978322, 0.47755310629360603, 0.6794611000489229, 0.5323277648459239, 0.5048698556929759, 0.6198832705437299, 0.36005397101395087, 0.6567060231277636, 0.5124441826912591, 0.46160953280172506, 0.36115738533496616, 0.5646069183859801, 0.4492731674939937, 0.38323221558490933, 0.5257424909554926, 0.49942944037792175, 0.7064662385132419, 0.6214522316017115, 0.5200668093844749, 0.45707185436551334, 0.5397702804186805, 0.7447965648010519, 0.46762050773885755, 0.5065815345592107, 0.5369480201799242], 
    '11524829': [0.6959929949861801, 0.7021342232941639, 0.46999529467488077, 0.4914646648780199, 0.4968359025654928, 0.4920193323424106, 0.6649852140611318, 0.4360973223272352, 0.4705471576408559, 0.6020451025667393, 0.47881076802747163, 0.704918778609779, 0.633576389862673, 0.5968533527778557, 0.4594472645234067, 0.48945290468133107, 0.5197489662307229, 0.5027699096016678, 0.36330937045242795, 0.43049237643847393, 0.38800858799737004, 0.430945458738038, 0.7072627160632321, 0.44442979873049704, 0.50180453892488, 0.4900106882550722, 0.4748632807022464, 0.4379115211911016, 0.44309672715034915, 0.4114214756024218, 0.29884143054348067, 0.43446229975102285, 0.3575785337459062, 0.5020809378242701, 0.40582120387768644, 0.4526591319142571, 0.476084483956711, 0.4917921679707584, 0.46776509521272125, 0.6643330123740703, 0.349507187306217, 0.5051244418269125, 0.48697684419141635, 0.41235381552009426, 0.6522272391582765, 0.5085518505015378, 0.6846883734844024, 0.4937369318164113, 0.40223019946215954, 0.7004677280135114, 0.508833858397759, 0.513949263507555, 0.6296161264891107, 0.42387625306547255, 0.41302377903045373, 0.29035314867269324, 0.6657361964146046, 0.49293733815707064, 0.49297379663647156, 0.4926151324502279], 
} # best = 11120653 trial 2 with mean pooling

threshold = 0.7 # if threshold >= 0.5 -> gets aucs above threshold, if threshold < 0.5 -> gets aucs below threshold
jobs_trials = {}
pooling = []

dicts = [auc_scores_lstm_ocsvm_hypertraining, auc_scores_lstm_ocsvm]

# count total nr of poolings used
mean_count = 0
first_count = 0
last_count = 0

for auc_scores_dict in dicts:
    for job_id, auc_scores in auc_scores_dict.items():
        # get trials of current job 
        trials = load_trials(job_id, remove_unwanted=False) # do not remove unwanted, otherwise trial nr. is wrong
        
        # find total counts of poolings used
        trial_poolings = [trial['result']['hyper_parameters']['pooling'] for trial in trials]
        mean_count += trial_poolings.count('mean')
        first_count += trial_poolings.count('last_reversed')
        last_count += trial_poolings.count('last')
        
        # get pooling of trials according to threshold
        if threshold >= 0.5:
            indices = [i for i, auc in enumerate(auc_scores) if auc >= threshold]
        else:
            indices = [i for i, auc in enumerate(auc_scores) if auc <= threshold]
        jobs_trials[job_id] = indices
        trials = [trials[idx] for idx in indices]
        pooling.extend([trial['result']['hyper_parameters']['pooling'] for trial in trials])


plt.bar(
    ["Mean", "First", "Last"], 
    [pooling.count('mean')/mean_count*100 if mean_count != 0 else 0, 
    pooling.count('last_reversed')/first_count*100 if first_count != 0 else 0, 
    pooling.count('last')/last_count*100 if last_count != 0 else 0],
    alpha=0.8,
    zorder=3,
)
plt.ylabel(r"Percentage Of Models $(\%)$")
plt.grid(alpha=0.4)

# save plot without title
out_file = "testing/output/bar_plots"
plt.savefig(out_file+"_no_title")

# save plot with title
plt.title(f"Pooling Methods Of Models With AUC {'Above' if threshold >=0.5 else 'Below'} {threshold}")
plt.savefig(out_file)
plt.close('all')